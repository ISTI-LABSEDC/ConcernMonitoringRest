2023-01-25T12:21:46.694+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:21:46.698+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:21:46.706+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:21:46.721+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:21:46.901+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:21:46.901+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:21:46.901+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:21:46.937+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:21:46.937+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:21:46.940+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:21:47.372+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:21:47.409+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:21:47.819+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:23:44.285+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
		not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:23:44.969+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T12:23:44.969+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T12:24:58.878+0100 [grizzly-http-server-0] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker stop
2023-01-25T12:24:58.878+0100 [grizzly-http-server-0] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker stopped
2023-01-25T12:24:58.879+0100 [grizzly-http-server-0] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connector Stopped
2023-01-25T12:25:03.475+0100 [grizzly-http-server-3] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:25:03.477+0100 [grizzly-http-server-3] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:25:03.478+0100 [grizzly-http-server-3] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:25:03.480+0100 [grizzly-http-server-3] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:25:03.491+0100 [grizzly-http-server-3] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:25:03.492+0100 [grizzly-http-server-3] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:25:03.493+0100 [grizzly-http-server-3] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:25:03.494+0100 [grizzly-http-server-3] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:25:03.494+0100 [grizzly-http-server-3] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:25:03.495+0100 [grizzly-http-server-3] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:25:03.502+0100 [grizzly-http-server-3] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:25:03.508+0100 [Thread-29] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:25:03.540+0100 [Thread-29] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:25:16.957+0100 [grizzly-http-server-8] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T12:25:16.958+0100 [grizzly-http-server-8] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule catchFirstAndCheckSecond removed
2023-01-25T12:25:16.959+0100 [grizzly-http-server-8] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule active: 1
2023-01-25T12:25:23.744+0100 [grizzly-http-server-14] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 0
2023-01-25T12:25:23.746+0100 [grizzly-http-server-14] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule catchFirstAndSecond removed
2023-01-25T12:25:23.747+0100 [grizzly-http-server-14] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule active: 0
2023-01-25T12:25:44.621+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
		not($bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:27:35.506+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:27:35.509+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:27:35.515+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:27:35.528+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:27:35.705+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:27:35.705+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:27:35.705+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:27:35.738+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:27:35.738+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:27:35.740+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:27:36.122+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:27:36.160+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:27:36.542+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:27:41.617+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
		not($bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:27:42.309+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T12:27:42.310+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T12:28:40.464+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T12:28:40.464+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674646120434
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T12:28:40.503+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:28:40.503+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T12:28:40.503+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:28:41.465+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T12:28:41.467+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674646121457
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T12:30:15.709+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:30:15.711+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:30:15.716+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:30:15.729+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:30:15.914+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:30:15.914+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:30:15.914+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:30:15.948+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:30:15.949+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:30:15.952+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:30:16.295+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:30:16.336+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:30:16.692+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:30:21.064+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
		not($bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:30:21.735+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T12:30:21.735+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T12:30:30.776+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T12:30:30.777+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674646230757
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T12:30:30.804+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:30:30.804+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T12:30:30.804+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:30:36.778+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T12:30:36.779+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674646236772
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T12:32:41.933+0100 [grizzly-http-server-11] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T12:32:41.934+0100 [grizzly-http-server-11] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule catchFirstAndCheckSecond removed
2023-01-25T12:32:41.935+0100 [grizzly-http-server-11] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule active: 1
2023-01-25T12:32:45.021+0100 [grizzly-http-server-14] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 0
2023-01-25T12:32:45.023+0100 [grizzly-http-server-14] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule catchFirstAndSecond removed
2023-01-25T12:32:45.024+0100 [grizzly-http-server-14] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule active: 0
2023-01-25T12:32:49.494+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker stop
2023-01-25T12:32:49.495+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker stopped
2023-01-25T12:32:49.495+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connector Stopped
2023-01-25T12:32:52.933+0100 [grizzly-http-server-4] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:32:52.935+0100 [grizzly-http-server-4] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:32:52.936+0100 [grizzly-http-server-4] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:32:52.936+0100 [grizzly-http-server-4] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:32:52.948+0100 [grizzly-http-server-4] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:32:52.949+0100 [grizzly-http-server-4] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:32:52.950+0100 [grizzly-http-server-4] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:32:52.950+0100 [grizzly-http-server-4] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:32:52.951+0100 [grizzly-http-server-4] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:32:52.952+0100 [grizzly-http-server-4] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:32:52.959+0100 [grizzly-http-server-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:32:52.964+0100 [Thread-29] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:32:52.996+0100 [Thread-29] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:33:09.749+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
		not($bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:33:53.805+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
		not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:35:15.405+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:35:15.408+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:35:15.413+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:35:15.426+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:35:15.596+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:35:15.596+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:35:15.596+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:35:15.630+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:35:15.630+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:35:15.633+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:35:16.017+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:35:16.050+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:35:16.345+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:35:21.417+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
		not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:35:22.021+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T12:35:22.021+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T12:35:42.976+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T12:35:42.976+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674646542953
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T12:35:43.002+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:35:43.003+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T12:35:43.003+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:37:18.813+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:37:18.815+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:37:18.821+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:37:18.834+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:37:19.007+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:37:19.007+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:37:19.008+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:37:19.050+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:37:19.050+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:37:19.053+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:37:19.445+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:37:19.476+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:37:19.787+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:37:25.301+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		)
		not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:37:26.020+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T12:37:26.020+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T12:37:35.137+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T12:37:35.138+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674646655108
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T12:37:35.169+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:37:35.169+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T12:37:35.170+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:38:39.833+0100 [grizzly-http-server-0] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T12:38:39.835+0100 [grizzly-http-server-0] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule catchFirstAndSecond removed
2023-01-25T12:38:39.837+0100 [grizzly-http-server-0] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule active: 1
2023-01-25T12:38:47.220+0100 [grizzly-http-server-5] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 0
2023-01-25T12:38:47.222+0100 [grizzly-http-server-5] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule catchFirstAndCheckSecond removed
2023-01-25T12:38:47.223+0100 [grizzly-http-server-5] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - Rule active: 0
2023-01-25T12:38:53.323+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		)
		not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after[0,24h] $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:38:53.389+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T12:38:53.389+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T12:39:01.792+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T12:39:01.792+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674646741777
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T12:39:01.794+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:39:01.794+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T12:39:01.795+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:40:33.703+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:40:33.707+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:40:33.713+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:40:33.726+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:40:33.918+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:40:33.918+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:40:33.919+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:40:33.962+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:40:33.963+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:40:33.965+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:40:34.319+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:40:34.350+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:40:34.686+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:40:39.918+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		)
		not(ConcernICTGatewayEvent(
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after[0,24h] $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:40:40.644+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T12:40:40.645+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T12:40:57.125+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T12:40:57.126+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674646857104
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T12:40:57.151+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:40:57.152+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T12:40:57.152+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T12:42:42.657+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T12:42:42.660+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T12:42:42.666+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T12:42:42.680+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T12:42:42.857+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T12:42:42.857+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T12:42:42.857+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T12:42:42.900+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T12:42:42.901+0100 [grizzly-http-server-1] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T12:42:42.904+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T12:42:43.236+0100 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T12:42:43.269+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T12:42:43.620+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T12:42:48.260+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T12:43:05.695+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 10
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
end

2023-01-25T15:48:58.303+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T15:48:58.305+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T15:48:58.309+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T15:48:58.316+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T15:48:58.549+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T15:48:58.549+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T15:48:58.549+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T15:48:58.573+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T15:48:58.573+0100 [grizzly-http-server-2] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T15:48:58.575+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T15:48:58.782+0100 [grizzly-http-server-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T15:48:58.802+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T15:48:58.987+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T15:49:05.599+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("created complexEvent");
end

2023-01-25T15:49:06.037+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T15:49:06.037+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T15:49:53.574+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T15:49:53.575+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674658193556
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T15:49:59.577+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T15:49:59.579+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674658199570
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T15:49:59.592+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T15:49:59.592+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - created complexEvent
2023-01-25T15:49:59.593+0100 [Thread-24] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T15:53:55.922+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T15:53:55.924+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T15:53:55.927+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T15:53:55.935+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T15:53:56.117+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T15:53:56.118+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T15:53:56.118+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T15:53:56.139+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T15:53:56.139+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T15:53:56.140+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T15:53:56.336+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T15:53:56.354+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T15:53:56.536+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T15:58:10.053+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T15:58:10.072+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T15:58:10.072+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T15:58:10.083+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		)
		not(ConcernICTGatewayEvent(
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after[0,24h] $aEvent) from entry-point "EVENTS EntryPoint");
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T15:58:10.584+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T15:58:10.584+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T15:58:24.153+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T15:58:24.153+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674658704135
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T15:58:24.173+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T15:58:24.173+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T15:58:24.173+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T15:58:31.156+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T15:58:31.158+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674658711149
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:32:06.844+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:32:06.845+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:32:06.859+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:32:06.867+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:32:07.048+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:32:07.049+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:32:07.049+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:32:07.071+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:32:07.071+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:32:07.072+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:32:07.265+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:32:07.284+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:32:07.462+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:32:11.344+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:32:11.345+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674660731315
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:32:18.340+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:32:18.342+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674660738332
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:33:03.835+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:33:03.837+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:33:03.840+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:33:03.848+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:33:04.104+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:33:04.105+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:33:04.105+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:33:04.134+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:33:04.135+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:33:04.136+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:33:04.339+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:33:04.357+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:33:04.533+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:33:09.302+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:33:09.302+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674660789273
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:33:16.297+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:33:16.299+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674660796288
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:34:08.325+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:34:08.328+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:34:08.332+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:34:08.340+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:34:08.525+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:34:08.526+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:34:08.526+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:34:08.547+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:34:08.547+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:34:08.549+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:34:08.739+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:34:08.757+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:34:08.931+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:34:24.204+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:34:24.204+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674660864174
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:34:31.199+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:34:31.202+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674660871190
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:35:43.681+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:35:43.683+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:35:43.696+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:35:43.704+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:35:43.881+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:35:43.881+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:35:43.882+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:35:43.904+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:35:43.904+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:35:43.905+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:35:44.111+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:35:44.129+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:35:44.314+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:35:46.603+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:35:46.650+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:35:46.651+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:35:46.669+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		)
		not(ConcernICTGatewayEvent( this != $aEvent,
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION");
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:36:00.851+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:36:00.853+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:36:00.856+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:36:00.864+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:36:01.107+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:36:01.108+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:36:01.108+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:36:01.135+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:36:01.135+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:36:01.137+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:36:01.337+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:36:01.355+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:36:01.528+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:36:03.683+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:36:03.713+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:36:03.714+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:36:03.724+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		)
		not(ConcernICTGatewayEvent( this != $aEvent,
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION"));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:36:04.208+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:36:04.208+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T16:36:07.945+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:36:07.945+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674660967925
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:36:07.964+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:36:07.965+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:36:07.965+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:36:14.949+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:36:14.952+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674660974941
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:37:25.994+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:37:25.996+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:37:26.000+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:37:26.008+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:37:26.187+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:37:26.187+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:37:26.187+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:37:26.215+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:37:26.216+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:37:26.218+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:37:26.418+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:37:26.439+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:37:26.618+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:37:39.919+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:37:39.947+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:37:39.948+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:37:39.962+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION");
		
		not(ConcernICTGatewayEvent( this != $aEvent,
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:37:40.456+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:37:40.456+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T16:37:45.101+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:37:45.101+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674661065081
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:37:45.121+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:37:45.121+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:37:45.121+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:37:52.104+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:37:52.106+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674661072096
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:39:01.394+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:39:05.117+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:39:05.119+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:39:05.122+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:39:05.130+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:39:05.301+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:39:05.301+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:39:05.311+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:39:05.336+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:39:05.336+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:39:05.338+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:39:05.534+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:39:05.552+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:39:05.730+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:39:12.833+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:39:12.887+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:39:12.888+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:39:12.902+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION");
		
		not(ConcernICTGatewayEvent( this != $aEvent,
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after [0s,24h] $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:39:13.384+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:39:13.384+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T16:39:17.070+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:39:17.081+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674661157052
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:39:17.094+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:39:17.094+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:39:17.095+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:39:24.075+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:39:24.077+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674661164067
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:46:01.123+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:46:01.124+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:46:01.128+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:46:01.137+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:46:01.317+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:46:01.317+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:46:01.318+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:46:01.341+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:46:01.341+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:46:01.343+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:46:01.542+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:46:01.561+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:46:01.737+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:46:04.980+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:46:05.040+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:46:05.041+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:46:05.057+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION");
		
		not(ConcernICTGatewayEvent(
			this.senderID == "ICTGW_Probe",
			this.destinationID == "Monitoring",
			this.name == "REGISTRATION_RESPONSE",
			this.ICTMessageType == "REGISTRATION_RESPONSE",
			this.ICTMessageCategory == "REGISTRATION",
			this after [0,24h] $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:46:05.493+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:46:05.493+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T16:46:09.546+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:46:09.546+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674661569527
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:46:09.565+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:46:09.565+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:46:09.566+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:46:16.550+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:46:16.552+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674661576542
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:47:09.417+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:47:09.419+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:47:09.423+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:47:09.432+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:47:09.619+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:47:09.620+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:47:09.620+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:47:09.642+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:47:09.643+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:47:09.644+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:47:09.845+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:47:09.862+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:47:10.037+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:47:14.569+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:47:14.588+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:47:14.588+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:47:14.598+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
		not(ConcernICTGatewayEvent(
			this.senderID == "ICTGW_Probe",
			this.destinationID == "Monitoring",
			this.name == "REGISTRATION_RESPONSE"
			this after [0,24h] $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:48:02.965+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:48:02.967+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:48:02.970+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:48:02.979+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:48:03.156+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:48:03.156+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:48:03.156+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:48:03.179+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:48:03.179+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:48:03.180+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:48:03.371+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:48:03.389+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:48:03.570+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:48:07.347+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:48:07.379+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:48:07.380+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:48:07.393+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
		not(ConcernICTGatewayEvent(
			this.senderID == "ICTGW_Probe",
			this.destinationID == "Monitoring",
			this.name == "REGISTRATION_RESPONSE",
			this after [0,24h] $aEvent));
	
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:48:07.789+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:48:07.789+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T16:48:15.277+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:48:15.277+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674661695257
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:48:15.295+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:48:15.295+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:48:15.296+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:48:22.280+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:48:22.282+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674661702273
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:49:36.953+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:49:36.955+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:49:36.958+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:49:36.967+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:49:37.158+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:49:37.158+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:49:37.158+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:49:37.181+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:49:37.181+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:49:37.182+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:49:37.400+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:49:37.418+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:49:37.591+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:49:41.198+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:49:41.235+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:49:41.236+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:49:41.249+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires (24h)
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST")
		
		not(ConcernICTGatewayEvent(
			this.senderID == "ICTGW_Probe",
			this.destinationID == "Monitoring",
			this.name == "REGISTRATION_RESPONSE",
			this after[0,24h] $aEvent));
	
then
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:49:41.641+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:49:41.641+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T16:49:46.140+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:49:46.140+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674661786121
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:49:46.157+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:49:46.158+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:49:46.158+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:49:53.140+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:49:53.141+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674661793136
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:50:05.081+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:50:05.083+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:50:05.086+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:50:05.095+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:50:05.276+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:50:05.277+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:50:05.277+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:50:05.301+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:50:05.301+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:50:05.302+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:50:05.499+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:50:05.517+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:50:05.692+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:50:11.071+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:50:11.107+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:50:11.108+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:50:11.120+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST")
		
		not(ConcernICTGatewayEvent(
			this.senderID == "ICTGW_Probe",
			this.destinationID == "Monitoring",
			this.name == "REGISTRATION_RESPONSE",
			this after[0,24h] $aEvent));
	
then
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:50:11.517+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:50:11.518+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T16:50:14.599+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:50:14.599+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674661814580
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:50:14.618+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:50:14.619+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:50:14.619+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:50:21.602+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:50:21.604+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674661821594
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:50:58.959+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:50:58.960+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:50:58.963+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:50:58.971+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:50:59.155+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:50:59.155+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:50:59.156+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:50:59.177+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:50:59.177+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:50:59.179+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:50:59.374+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:50:59.410+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:50:59.596+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:51:05.269+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:51:05.286+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:51:05.287+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:51:05.297+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
		$bEvent: ConcernICTGatewayEvent(
			this.senderID != "ICTGW_Probe",
			this.destinationID != "Monitoring",
			this.name != "REGISTRATION_RESPONSE",
			this after $aEvent));
	
then
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:51:16.836+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:51:16.838+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:51:16.841+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:51:16.849+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:51:17.036+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:51:17.037+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:51:17.037+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:51:17.058+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:51:17.058+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:51:17.059+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:51:17.255+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:51:17.274+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:51:17.456+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:51:20.276+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:51:20.328+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:51:20.329+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:51:20.342+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
		$bEvent: ConcernICTGatewayEvent(
			this.senderID != "ICTGW_Probe",
			this.destinationID != "Monitoring",
			this.name != "REGISTRATION_RESPONSE",
			this after $aEvent);
	
then
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:51:20.759+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:51:20.759+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T16:51:22.730+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:51:22.730+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674661882708
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:51:29.731+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:51:29.731+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674661889726
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:52:39.724+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:52:39.726+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:52:39.730+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:52:39.739+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:52:39.933+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:52:39.934+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:52:39.934+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:52:39.965+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:52:39.966+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:52:39.968+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:52:40.186+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:52:40.206+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:52:40.388+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:52:45.520+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:52:45.554+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:52:45.555+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:52:45.568+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
		$bEvent: ConcernICTGatewayEvent(
			this.senderID == "ICTGW_Probe",
			this.destinationID == "Monitoring",
			this.name != "REGISTRATION_RESPONSE",
			this after $aEvent);
	
then
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:52:45.978+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:52:45.979+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T16:52:48.603+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:52:48.603+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674661968584
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:52:55.607+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:52:55.609+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674661975599
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:52:55.612+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:52:55.613+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:52:55.613+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:54:26.986+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:54:26.988+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:54:26.991+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:54:26.999+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:54:27.195+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:54:27.195+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:54:27.195+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:54:27.219+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:54:27.219+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:54:27.221+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:54:27.426+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:54:27.446+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:54:27.620+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:54:32.754+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:54:32.799+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:54:32.800+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:54:32.814+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
		$bEvent: ConcernICTGatewayEvent(
			this.senderID == $aEvent.getSenderID(),
			this.destinationID == $aEvent.getDestinationID(),
			this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
			this after $aEvent);
	
then
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:54:33.243+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:54:33.244+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T16:55:25.741+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:55:25.742+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674662125718
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:55:31.745+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:55:31.747+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674662131736
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:55:31.752+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:55:31.752+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T16:55:31.753+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T16:55:59.576+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T16:55:59.578+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T16:55:59.581+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T16:55:59.590+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T16:55:59.789+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T16:55:59.790+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T16:55:59.790+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T16:55:59.811+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T16:55:59.812+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T16:55:59.813+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T16:56:00.013+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T16:56:00.032+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T16:56:00.204+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T16:56:04.291+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T16:56:04.341+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T16:56:04.342+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T16:56:04.356+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
		$bEvent: ConcernICTGatewayEvent(
			this.senderID == $aEvent.getSenderID(),
			this.destinationID == $aEvent.getDestinationID(),
			this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
			this after $aEvent);
	
then
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T16:56:04.764+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T16:56:04.765+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T16:56:11.394+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:56:11.395+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674662171375
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T16:56:17.397+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T16:56:17.398+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674662177390
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:08:09.479+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:08:09.482+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:08:09.485+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:08:09.493+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:08:09.707+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:08:09.708+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:08:09.708+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:08:09.742+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:08:09.742+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:08:09.744+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:08:09.947+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:08:09.967+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:08:10.146+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:08:14.760+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T17:08:14.803+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T17:08:14.804+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T17:08:14.815+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
		
	$cEvent: ConcernICTGatewayEvent(
		this.senderID == $bEvent.getSenderID(),
		this.destinationID == $bEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after bEvent);
		
	$dEvent: ConcernICTGatewayEvent(
		this.senderID == $cEvent.getSenderID(),
		this.destinationID == $cEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after cEvent);

then
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T17:09:13.552+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:09:13.554+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:09:13.558+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:09:13.566+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:09:13.754+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:09:13.754+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:09:13.755+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:09:13.777+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:09:13.778+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:09:13.780+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:09:13.990+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:09:14.010+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:09:14.188+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:09:17.752+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T17:09:17.812+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T17:09:17.813+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T17:09:17.827+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
		
	$cEvent: ConcernICTGatewayEvent(
		this.senderID == $bEvent.getSenderID(),
		this.destinationID == $bEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $bEvent);
		
	$dEvent: ConcernICTGatewayEvent(
		this.senderID == $cEvent.getSenderID(),
		this.destinationID == $cEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $cEvent);

then
		retract($aEvent);
		retract($bEvent);
		retract($cEvent);
		retract($dEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T17:09:18.244+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T17:09:18.244+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T17:09:24.619+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:09:24.621+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:09:24.624+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:09:24.632+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:09:24.800+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:09:24.999+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:09:25.039+0100 [Thread-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:09:25.223+0100 [Thread-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:09:37.976+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:09:37.977+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674662977955
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:09:43.978+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:09:43.980+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674662983971
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:09:44.983+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:09:44.985+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674662984976
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:09:45.988+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:09:45.998+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674662985981
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:10:28.218+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:10:28.220+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:10:28.223+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:10:28.231+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:10:28.447+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:10:28.447+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:10:28.448+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:10:28.472+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:10:28.472+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:10:28.473+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:10:28.669+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:10:28.688+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:10:28.873+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:10:33.107+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T17:10:33.131+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T17:10:33.131+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T17:10:33.141+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
		
	$cEvent: ConcernICTGatewayEvent(
		this.senderID == $bEvent.getSenderID(),
		this.destinationID == $bEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $bEvent);
		
	$dEvent: ConcernICTGatewayEvent(
		this.senderID == $cEvent.getSenderID(),
		this.destinationID == $cEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $cEvent, this after[1m] $aEvent);

then
		retract($aEvent);
		retract($bEvent);
		retract($cEvent);
		retract($dEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T17:10:33.561+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T17:10:33.561+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T17:24:41.853+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:24:41.854+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674663881835
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:24:47.854+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:24:47.855+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674663887849
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:24:48.860+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:24:48.862+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674663888853
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:24:49.866+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:24:49.868+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674663889859
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:25:21.756+0100 [ActiveMQ Session Task-3] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:25:21.756+0100 [ActiveMQ Session Task-3] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674663921737
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:25:27.762+0100 [ActiveMQ Session Task-3] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:25:27.765+0100 [ActiveMQ Session Task-3] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674663927755
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:25:28.767+0100 [ActiveMQ Session Task-3] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:25:28.770+0100 [ActiveMQ Session Task-3] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674663928760
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:26:23.773+0100 [ActiveMQ Session Task-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:26:23.773+0100 [ActiveMQ Session Task-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674663983765
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:26:58.768+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:26:58.770+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:26:58.773+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:26:58.781+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:26:58.970+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:26:58.970+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:26:58.970+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:26:58.992+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:26:58.992+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:26:58.993+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:26:59.201+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:26:59.217+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:26:59.402+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:27:04.366+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T17:27:04.427+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T17:27:04.428+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T17:27:04.443+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
		
	$cEvent: ConcernICTGatewayEvent(
		this.senderID == $bEvent.getSenderID(),
		this.destinationID == $bEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $bEvent);
		
	$dEvent: ConcernICTGatewayEvent(
		this.senderID == $cEvent.getSenderID(),
		this.destinationID == $cEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $cEvent, this before[1m] $aEvent);

then
		retract($aEvent);
		retract($bEvent);
		retract($cEvent);
		retract($dEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T17:27:04.870+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T17:27:04.870+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T17:27:19.511+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:27:19.511+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674664039493
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:27:25.515+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:27:25.517+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674664045507
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:27:26.521+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:27:26.523+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674664046513
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:28:21.534+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:28:21.536+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674664101519
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:31:23.318+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:31:23.321+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:31:23.326+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:31:23.336+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:31:23.526+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:31:23.526+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:31:23.526+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:31:23.557+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:31:23.557+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:31:23.559+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:31:23.786+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:31:23.805+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:31:23.978+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:31:28.479+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T17:31:28.499+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T17:31:28.499+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T17:31:28.510+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST")
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent)
		
	$cEvent: ConcernICTGatewayEvent(
		this.senderID == $bEvent.getSenderID(),
		this.destinationID == $bEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $bEvent)
		
	$dEvent: ConcernICTGatewayEvent(
		this.senderID == $cEvent.getSenderID(),
		this.destinationID == $cEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $cEvent, this before[1m] $aEvent)

then
		retract($aEvent);
		retract($bEvent);
		retract($cEvent);
		retract($dEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T17:31:29.030+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T17:31:29.031+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T17:31:59.520+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:31:59.521+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674664319502
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:32:08.180+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:32:08.182+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:32:08.186+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:32:08.193+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:32:08.434+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:32:08.435+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:32:08.435+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:32:08.464+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:32:08.464+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:32:08.465+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:32:08.660+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:32:08.678+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:32:08.852+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:32:18.952+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T17:32:18.984+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T17:32:18.984+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T17:32:18.994+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST")
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent)
		
	$cEvent: ConcernICTGatewayEvent(
		this.senderID == $bEvent.getSenderID(),
		this.destinationID == $bEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $bEvent)
		
	$dEvent: ConcernICTGatewayEvent(
		this.senderID == $cEvent.getSenderID(),
		this.destinationID == $cEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $cEvent, this before[1m] $aEvent)

then
		retract($aEvent);
		retract($bEvent);
		retract($cEvent);
		retract($dEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T17:32:19.414+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T17:32:19.415+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 1
2023-01-25T17:32:23.972+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:32:23.972+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674664343954
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:32:29.976+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:32:29.978+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674664349968
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:32:29.980+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:32:29.981+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674664349973
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:32:30.983+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:32:30.984+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674664350978
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:35:09.633+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:35:09.635+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:35:09.639+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:35:09.647+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:35:09.824+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:35:09.824+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:35:09.824+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:35:09.846+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:35:09.846+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:35:09.847+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:35:10.044+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:35:10.063+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:35:10.239+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:35:12.640+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T17:35:12.673+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T17:35:12.674+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T17:35:12.685+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end



rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end
2023-01-25T17:35:13.140+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T17:35:13.141+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
2023-01-25T17:41:11.334+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:41:11.335+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674664871315
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:41:14.338+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:41:14.340+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674664874330
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:41:14.360+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T17:41:14.362+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T17:41:14.363+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T17:41:15.343+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:41:15.346+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674664875335
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:53:32.786+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:53:32.787+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:53:32.791+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:53:32.798+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:53:32.999+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:53:32.999+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:53:32.999+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:53:33.028+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:53:33.028+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:53:33.030+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:53:33.241+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:53:33.260+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:53:33.442+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:53:35.413+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:53:35.419+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:53:35.436+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:53:35.470+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:53:35.691+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:53:36.248+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:53:36.343+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:53:36.823+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:53:42.745+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:53:42.749+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:53:42.760+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:53:42.784+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:53:43.004+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:53:43.536+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:53:43.641+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:53:50.885+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T17:53:50.887+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T17:53:50.890+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T17:53:50.898+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T17:53:51.085+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T17:53:51.085+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T17:53:51.086+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T17:53:51.109+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T17:53:51.110+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T17:53:51.111+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T17:53:51.329+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T17:53:51.350+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T17:53:51.543+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T17:53:57.375+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T17:53:57.436+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T17:53:57.437+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T17:53:57.451+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end



rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end
2023-01-25T17:53:57.912+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T17:53:57.913+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 3
2023-01-25T17:54:03.808+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:54:03.808+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674665643787
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:54:06.811+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:54:06.813+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674665646804
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:54:06.820+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T17:54:06.820+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T17:54:06.821+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T17:54:09.817+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T17:54:09.819+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674665649809
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T17:54:09.821+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T17:54:09.821+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T17:54:09.821+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T18:02:01.374+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:02:01.377+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:02:01.381+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:02:01.392+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:02:01.578+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:02:01.579+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:02:01.579+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:02:01.602+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:02:01.603+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:02:01.604+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:02:01.819+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:02:01.838+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:02:02.012+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:02:06.323+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:02:06.381+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:02:06.382+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:02:06.395+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare SecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	SecondAndThirdEvent captured = new SecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end
2023-01-25T18:02:06.926+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T18:02:06.926+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 4
2023-01-25T18:02:30.723+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:02:30.724+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674666150705
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:02:33.727+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:02:33.729+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674666153720
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:02:33.753+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:02:33.754+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T18:02:33.755+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:02:36.732+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:02:36.734+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674666156725
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:02:36.737+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:02:36.737+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T18:02:36.738+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:02:39.737+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:02:39.740+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674666159730
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:03:03.269+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:03:03.271+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:03:03.274+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:03:03.282+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:03:03.473+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:03:03.473+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:03:03.473+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:03:03.503+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:03:03.503+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:03:03.504+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:03:03.717+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:03:03.735+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:03:03.908+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:03:07.166+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:03:07.228+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:03:07.229+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:03:07.244+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare SecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	SecondAndThirdEvent captured = new SecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end
2023-01-25T18:03:07.770+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T18:03:07.771+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 4
2023-01-25T18:03:09.973+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:03:09.973+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674666189954
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:03:12.976+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:03:12.979+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674666192969
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:03:13.009+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:03:13.009+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T18:03:13.010+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:03:15.982+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:03:15.983+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674666195974
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:03:15.989+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:03:15.990+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T18:03:15.991+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:03:18.987+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:03:18.989+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674666198979
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:03:40.527+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:03:40.530+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:03:40.534+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:03:40.545+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:03:40.720+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:03:40.720+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:03:40.721+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:03:40.743+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:03:40.743+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:03:40.745+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:03:40.948+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:03:40.969+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:03:41.156+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:03:45.203+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:03:45.271+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:03:45.273+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:03:45.304+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare SecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	SecondAndThirdEvent captured = new SecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end
2023-01-25T18:03:45.821+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T18:03:45.821+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 4
2023-01-25T18:03:55.690+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:03:55.690+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674666235672
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:03:58.695+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:03:58.697+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674666238686
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:03:58.716+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:03:58.718+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T18:03:58.719+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:04:01.699+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:04:01.700+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674666241691
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:04:01.712+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T18:04:01.713+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T18:04:01.713+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T18:32:06.270+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:32:06.272+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:32:06.275+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:32:06.284+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:32:06.471+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:32:06.471+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:32:06.471+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:32:06.494+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:32:06.494+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:32:06.496+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:32:06.708+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:32:06.726+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:32:06.899+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:32:10.473+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:32:10.510+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:32:10.510+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:32:10.523+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before 1m $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T18:32:45.649+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:32:45.651+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:32:45.655+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:32:45.663+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:32:45.838+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:32:45.838+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:32:45.839+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:32:45.861+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:32:45.861+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:32:45.863+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:32:46.058+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:32:46.085+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:32:46.267+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:32:52.554+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:32:52.596+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:32:52.596+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:32:52.609+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before 1m $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T18:40:48.520+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:40:48.522+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:40:48.525+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:40:48.534+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:40:48.788+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:40:48.788+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:40:48.788+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:40:48.815+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:40:48.816+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:40:48.817+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:40:49.027+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:40:49.048+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:40:49.239+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:40:56.805+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:40:56.862+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:40:56.863+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:40:56.877+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T18:40:57.447+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T18:40:57.447+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T18:41:18.036+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:41:18.037+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674668478018
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:41:21.040+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:41:21.042+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674668481032
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:41:21.058+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:41:21.059+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T18:41:21.060+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:41:24.046+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:41:24.047+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674668484038
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:41:24.058+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:41:24.059+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T18:41:24.061+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:41:27.050+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:41:27.052+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674668487043
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:53:14.426+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:53:14.428+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:53:14.431+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:53:14.439+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:53:14.644+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:53:14.644+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:53:14.645+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:53:14.667+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:53:14.668+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:53:14.669+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:53:14.867+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:53:14.886+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:53:15.060+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:53:20.859+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:53:20.916+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:53:20.917+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:53:20.932+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T18:53:21.448+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T18:53:21.448+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T18:53:38.653+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:53:38.653+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674669218634
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:53:41.657+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:53:41.659+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674669221649
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:53:41.677+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:53:41.679+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T18:53:41.680+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:53:44.660+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:53:44.661+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674669224654
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:53:44.664+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:53:44.664+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T18:53:44.664+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:56:04.284+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:56:04.286+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:56:04.289+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:56:04.299+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:56:04.491+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:56:04.491+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:56:04.491+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:56:04.522+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:56:04.523+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:56:04.524+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:56:04.744+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:56:04.766+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:56:04.965+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:56:11.006+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:56:11.053+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:56:11.053+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:56:11.067+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T18:57:11.331+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:57:11.332+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:57:11.335+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:57:11.343+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:57:11.587+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:57:11.587+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:57:11.597+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:57:11.627+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:57:11.627+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:57:11.629+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:57:11.827+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:57:11.845+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:57:12.020+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:57:14.374+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:57:14.408+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:57:14.409+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:57:14.422+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T18:57:14.977+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T18:57:14.977+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T18:59:17.321+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T18:59:17.323+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T18:59:17.326+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T18:59:17.335+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T18:59:17.515+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T18:59:17.515+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T18:59:17.516+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T18:59:17.540+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T18:59:17.540+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T18:59:17.542+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T18:59:17.749+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T18:59:17.769+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T18:59:17.949+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T18:59:20.870+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T18:59:20.898+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T18:59:20.899+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T18:59:20.910+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T18:59:21.426+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T18:59:21.427+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T18:59:36.892+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:59:36.892+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674669576873
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:59:39.895+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:59:39.897+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674669579888
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:59:39.918+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:59:39.919+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T18:59:39.920+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:59:42.900+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T18:59:42.902+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674669582893
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T18:59:42.912+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T18:59:42.913+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T18:59:42.915+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:02:55.527+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:02:55.529+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:02:55.532+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:02:55.541+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:02:55.786+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:02:55.786+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:02:55.787+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:02:55.822+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:02:55.822+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:02:55.824+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:02:56.020+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:02:56.039+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:02:56.213+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:03:02.193+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:03:02.222+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:03:02.223+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:03:02.234+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T19:03:54.273+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:03:54.275+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:03:54.278+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:03:54.287+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:03:54.469+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:03:54.469+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:03:54.469+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:03:54.493+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:03:54.494+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:03:54.496+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:03:54.697+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:03:54.719+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:03:54.925+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:03:58.191+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:03:58.220+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:03:58.220+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:03:58.231+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T19:04:52.972+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:04:52.974+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:04:52.986+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:04:52.994+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:04:53.169+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:04:53.170+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:04:53.170+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:04:53.192+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:04:53.192+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:04:53.193+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:04:53.390+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:04:53.408+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:04:53.583+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:04:56.710+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:04:56.765+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:04:56.765+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:04:56.780+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	timestamp : long
	first : FirstAndSecondEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T19:04:57.330+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T19:04:57.331+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T19:05:00.874+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:05:00.875+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674669900856
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:05:03.877+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:05:03.879+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674669903870
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:05:03.901+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:05:03.902+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T19:05:03.902+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:05:06.883+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:05:06.885+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674669906874
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:05:06.896+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:05:06.897+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T19:05:06.899+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:10:27.906+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:10:27.908+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:10:27.911+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:10:27.919+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:10:28.111+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:10:28.112+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:10:28.112+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:10:28.135+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:10:28.135+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:10:28.137+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:10:28.333+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:10:28.351+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:10:28.527+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:10:47.996+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:10:48.035+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:10:48.035+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:10:48.054+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @timestamp( timestamp )
	destinationID : String
	senderID : String	
	first : FirstAndSecondEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T19:11:22.811+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:11:22.813+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:11:22.817+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:11:22.827+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:11:23.026+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:11:23.027+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:11:23.027+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:11:23.051+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:11:23.051+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:11:23.053+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:11:23.251+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:11:23.270+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:11:23.444+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:11:27.599+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:11:27.635+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:11:27.647+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:11:27.647+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : FirstAndSecondEvent
	second: ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T19:11:28.187+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T19:11:28.188+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T19:11:31.928+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:11:31.929+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674670291910
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:11:34.932+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:11:34.934+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674670294924
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:11:34.951+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:11:34.952+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T19:11:34.954+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:11:37.938+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:11:37.947+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674670297930
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:11:37.952+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:11:37.954+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T19:11:37.955+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:13:09.629+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:13:09.631+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:13:09.635+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:13:09.646+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:13:09.834+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:13:09.834+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:13:09.834+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:13:09.857+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:13:09.857+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:13:09.859+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:13:10.060+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:13:10.079+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:13:10.255+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:13:12.388+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:13:12.410+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:13:12.411+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:13:12.421+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : FirstAndSecondEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T19:14:02.341+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:14:02.343+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:14:02.346+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:14:02.354+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:14:02.540+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:14:02.541+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:14:02.541+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:14:02.564+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:14:02.564+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:14:02.565+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:14:02.776+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:14:02.797+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:14:02.979+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:14:05.526+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:14:05.555+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:14:05.555+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:14:05.567+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end
2023-01-25T19:14:06.088+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T19:14:06.088+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T19:14:39.179+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:14:39.181+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:14:39.184+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:14:39.193+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:14:39.381+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:14:39.382+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:14:39.382+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:14:39.405+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:14:39.406+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:14:39.407+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:14:39.605+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:14:39.624+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:14:39.821+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:14:41.936+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:14:41.965+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:14:41.966+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:14:41.976+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

2023-01-25T19:14:42.485+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T19:14:42.485+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 5
2023-01-25T19:14:45.069+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:14:45.070+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674670485051
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:14:48.072+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:14:48.074+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674670488065
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:14:48.104+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:14:48.105+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T19:14:48.105+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:14:51.078+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:14:51.079+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674670491069
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:14:51.091+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:14:51.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T19:14:51.095+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:15:27.978+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:15:27.980+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:15:27.983+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:15:27.991+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:15:28.173+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:15:28.174+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:15:28.174+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:15:28.205+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:15:28.205+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:15:28.206+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:15:28.406+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:15:28.424+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:15:28.603+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:15:33.297+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:15:33.329+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:15:33.329+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:15:33.342+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent, this before [1m] $aEvent.getFirst());
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T19:15:33.849+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T19:15:33.850+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T19:15:36.152+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:15:36.153+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674670536134
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:15:39.156+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:15:39.158+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674670539148
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:15:39.177+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:15:39.179+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T19:15:39.179+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:15:42.162+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:15:42.163+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674670542154
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:15:42.174+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:15:42.176+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T19:15:42.177+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:16:23.693+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:16:23.695+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:16:23.698+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:16:23.706+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:16:23.867+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:16:23.867+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:16:23.867+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:16:23.891+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:16:23.891+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:16:23.903+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:16:24.115+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:16:24.135+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:16:24.321+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:16:26.707+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:16:26.736+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:16:26.737+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:16:26.750+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T19:16:27.267+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T19:16:27.267+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T19:16:29.200+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:16:29.201+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674670589178
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:16:32.203+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:16:32.205+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674670592196
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:16:32.228+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:16:32.229+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T19:16:32.230+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:16:35.208+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:16:35.210+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674670595201
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:16:35.219+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:16:35.221+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T19:16:35.222+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:16:56.679+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T19:16:56.682+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T19:16:56.686+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T19:16:56.698+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T19:16:56.875+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T19:16:56.875+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T19:16:56.875+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T19:16:56.910+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T19:16:56.910+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T19:16:56.911+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T19:16:57.121+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T19:16:57.139+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T19:16:57.325+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T19:16:59.814+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T19:16:59.847+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T19:16:59.848+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T19:16:59.859+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T19:17:00.365+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T19:17:00.366+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T19:17:02.520+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:17:02.520+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674670622501
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:17:05.524+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:17:05.526+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674670625516
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:17:05.544+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:17:05.546+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T19:17:05.547+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:17:08.529+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:17:08.531+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674670628522
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:17:08.539+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:17:08.541+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created
2023-01-25T19:17:08.542+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:17:11.534+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T19:17:11.537+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674670631528
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T19:17:11.545+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T19:17:11.546+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed
2023-01-25T19:17:11.547+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:07:08.301+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:07:08.303+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:07:08.307+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:07:08.315+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:07:08.519+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:07:08.519+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:07:08.520+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:07:08.543+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:07:08.543+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:07:08.545+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:07:08.739+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:07:08.758+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:07:08.933+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:07:14.150+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:07:14.198+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:07:14.199+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:07:14.212+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST");
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T22:07:14.780+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:07:14.780+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 6
2023-01-25T22:07:18.305+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:07:18.305+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674680838284
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:07:21.308+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:07:21.310+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674680841301
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:18:21.093+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:18:21.095+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:18:21.098+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:18:21.106+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:18:21.307+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:18:21.308+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:18:21.308+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:18:21.331+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:18:21.332+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:18:21.333+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:18:21.538+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:18:21.557+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:18:21.731+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:18:25.341+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:18:25.375+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:18:25.376+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:18:25.391+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started");	
end

rule "doubleStart"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndCheckSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 100
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION"
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 100
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T22:18:26.019+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:18:26.019+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 8
2023-01-25T22:19:12.856+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:19:12.857+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674681552836
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:19:12.882+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:19:12.882+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started
2023-01-25T22:19:12.882+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:19:15.859+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:19:15.861+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674681555852
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:19:15.863+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:19:15.864+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started
2023-01-25T22:19:15.866+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:19:15.878+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:19:15.880+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T22:19:15.881+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:19:39.830+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:19:39.830+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674681579813
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:19:39.830+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:19:39.830+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started
2023-01-25T22:19:39.831+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:19:39.831+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:19:39.831+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674681579829
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:19:39.834+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:19:39.834+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T22:19:39.834+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:20:22.086+0100 [ActiveMQ Session Task-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:20:22.086+0100 [ActiveMQ Session Task-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674681622071
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:20:22.087+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:20:22.088+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started
2023-01-25T22:20:22.088+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:20:22.090+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:20:22.090+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T22:20:22.090+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:27:06.472+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:27:06.474+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:27:06.478+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:27:06.486+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:27:06.751+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:27:06.752+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:27:06.752+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:27:06.783+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:27:06.784+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:27:06.785+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:27:06.986+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:27:07.004+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:27:07.177+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:27:18.635+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:27:18.686+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:27:18.687+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:27:18.706+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started");	
end

rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T22:27:19.292+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:27:19.293+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 8
2023-01-25T22:27:38.273+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:27:38.273+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674682058253
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:32:54.878+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:32:54.881+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:32:54.885+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:32:54.896+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:32:55.084+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:32:55.084+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:32:55.084+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:32:55.106+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:32:55.107+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:32:55.109+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:32:55.343+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:32:55.362+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:32:55.538+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:33:01.962+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:33:01.982+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:33:01.982+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:33:01.994+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started");	
end

rule "checkStarter- Not sure"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not($bEvent : ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, this before $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T22:33:55.911+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:33:55.913+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:33:55.917+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:33:55.927+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:33:56.119+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:33:56.119+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:33:56.119+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:33:56.149+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:33:56.149+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:33:56.150+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:33:56.367+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:33:56.389+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:33:56.576+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:33:59.448+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:33:59.504+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:33:59.505+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:33:59.520+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started");	
end

rule "checkStarter- Not sure"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not($bEvent : ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent));
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T22:34:38.256+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:34:38.257+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:34:38.261+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:34:38.270+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:34:38.456+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:34:38.456+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:34:38.457+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:34:38.489+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:34:38.489+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:34:38.490+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:34:38.687+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:34:38.708+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:34:38.895+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:34:43.010+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:34:43.040+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:34:43.040+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:34:43.052+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started");	
end

rule "checkStarter- Not sure"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent));
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T22:34:43.626+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:34:43.627+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T22:35:07.206+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:35:07.206+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674682507184
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:35:07.230+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:35:07.231+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T22:35:07.231+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:35:15.013+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:35:15.013+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674682514997
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:35:15.013+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:35:15.014+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T22:35:15.014+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:35:34.079+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:35:34.079+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674682534064
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:35:34.083+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:35:34.083+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started
2023-01-25T22:35:34.084+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:35:37.086+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:35:37.089+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674682537079
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:35:37.097+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:35:37.099+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T22:35:37.101+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:36:01.931+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:36:01.932+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674682561888
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:36:01.934+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:36:01.935+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T22:36:01.935+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:36:28.350+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:36:28.352+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:36:28.356+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:36:28.364+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:36:28.556+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:36:28.557+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:36:28.557+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:36:28.579+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:36:28.579+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:36:28.581+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:36:28.802+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:36:28.821+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:36:29.003+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:36:45.865+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:36:45.884+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:36:45.884+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:36:45.898+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	name: String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started");	
end

rule "checkStarter- Not sure"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent));
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

2023-01-25T22:36:46.462+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:36:46.463+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T22:36:57.793+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:36:57.794+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674682617731
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:36:57.822+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:36:57.822+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T22:36:57.823+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:47:12.138+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:47:12.140+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:47:12.143+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:47:12.151+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:47:12.380+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:47:12.380+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:47:12.381+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:47:12.405+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:47:12.405+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:47:12.406+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:47:12.606+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:47:12.628+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:47:12.817+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:47:16.625+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:47:16.666+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:47:16.666+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:47:16.680+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started");	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent));
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event");	
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created");
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created");
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event");	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed");
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent) over windows:time(30s));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe");	
end

2023-01-25T22:47:17.298+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:47:17.299+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T22:47:41.372+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:47:41.372+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674683261353
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:47:41.416+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:47:41.416+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started
2023-01-25T22:47:41.416+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:47:44.376+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:47:44.378+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674683264368
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:47:44.388+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:47:44.390+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created
2023-01-25T22:47:44.391+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:47:47.381+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:47:47.382+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674683267373
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:47:47.393+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:47:47.395+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T22:47:47.397+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:47:50.382+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:47:50.383+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674683270378
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:47:50.389+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:47:50.390+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event
2023-01-25T22:47:50.390+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:53:34.586+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:53:34.588+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:53:34.591+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:53:34.599+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:53:34.798+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:53:34.799+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:53:34.799+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:53:34.822+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:53:34.822+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:53:34.824+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:53:35.033+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:53:35.054+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:53:35.250+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:53:39.747+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:53:39.767+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:53:39.767+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:53:39.777+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent));
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent) over windows:time(30s));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T22:53:40.385+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:53:40.386+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T22:53:47.491+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:53:47.491+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674683627473
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:53:47.520+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:53:47.520+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T22:53:47.521+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:53:50.494+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:53:50.496+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674683630487
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:53:50.500+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:53:50.500+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T22:53:50.501+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:53:53.500+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:53:53.510+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:53:53.513+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674683633492
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:53:53.513+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-25T22:53:53.515+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:53:56.505+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:53:56.506+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674683636498
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:53:56.511+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:53:56.511+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-25T22:53:56.512+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:57:14.798+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:57:14.801+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:57:14.805+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:57:14.816+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:57:15.020+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:57:15.020+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:57:15.020+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:57:15.043+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:57:15.043+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:57:15.045+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:57:15.242+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:57:15.265+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:57:15.472+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:57:19.613+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:57:19.656+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:57:19.657+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:57:19.670+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent) over windows:time(30s));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T22:57:20.267+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:57:20.267+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T22:57:24.624+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:57:24.625+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674683844603
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:57:24.654+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:24.654+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T22:57:24.654+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:27.628+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:57:27.630+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674683847620
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:57:27.643+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:27.645+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T22:57:27.647+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:30.633+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:57:30.635+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674683850626
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:57:30.645+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:30.646+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T22:57:30.647+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:30.653+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:57:30.655+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T22:57:30.656+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:57:43.177+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T22:57:43.178+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T22:57:43.182+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T22:57:43.190+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T22:57:43.380+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T22:57:43.380+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T22:57:43.380+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T22:57:43.403+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T22:57:43.403+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T22:57:43.405+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T22:57:43.606+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T22:57:43.625+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T22:57:43.810+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T22:57:50.745+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T22:57:50.772+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T22:57:50.773+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T22:57:50.783+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent) over windows:time(30s));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T22:57:51.400+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T22:57:51.400+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T22:57:53.886+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:57:53.887+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674683873869
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:57:53.914+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:53.914+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T22:57:53.915+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:56.890+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:57:56.893+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674683876882
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:57:56.906+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:56.908+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T22:57:56.909+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:59.896+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:57:59.897+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674683879888
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:57:59.910+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:59.913+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T22:57:59.914+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T22:57:59.923+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:57:59.924+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T22:57:59.925+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:58:02.898+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T22:58:02.899+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674683882894
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T22:58:02.905+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T22:58:02.906+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-25T22:58:02.906+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:00:29.795+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:00:29.797+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:00:29.800+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:00:29.808+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:00:29.996+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:00:29.997+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:00:29.997+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:00:30.018+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:00:30.019+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:00:30.020+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:00:30.221+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:00:30.239+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:00:30.412+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:00:38.371+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:00:38.394+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:00:38.394+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:00:38.408+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent) over windows:time(90s));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:00:39.149+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:00:39.149+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:00:42.247+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:00:42.247+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674684042222
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:00:42.272+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:00:42.272+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:00:42.273+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:00:45.248+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:00:45.250+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674684045240
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:00:45.261+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:00:45.262+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:00:45.263+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:00:48.252+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:00:48.255+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674684048246
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:00:48.264+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:00:48.265+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:00:48.266+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:00:48.273+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:00:48.274+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:00:48.275+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:00:51.259+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:00:51.261+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674684051251
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:00:51.275+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:00:51.276+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-25T23:00:51.277+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:01:26.947+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:01:26.950+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:01:26.954+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:01:26.965+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:01:27.149+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:01:27.149+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:01:27.150+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:01:27.171+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:01:27.171+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:01:27.173+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:01:27.365+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:01:27.384+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:01:27.556+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:01:30.961+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:01:30.985+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:01:30.986+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:01:30.997+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent)) over windows:time(90s);
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:02:05.688+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:02:05.690+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:02:05.694+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:02:05.702+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:02:05.887+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:02:05.888+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:02:05.888+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:02:05.917+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:02:05.918+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:02:05.919+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:02:06.119+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:02:06.142+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:02:06.336+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:02:12.155+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:02:12.186+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:02:12.187+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:02:12.200+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [20s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:02:12.797+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:02:12.797+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:02:20.342+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:02:20.343+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674684140324
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:02:20.368+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:02:20.369+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:02:20.369+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:02:23.346+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:02:23.348+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674684143338
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:02:23.359+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:02:23.361+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:02:23.363+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:02:26.352+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:02:26.354+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674684146344
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:02:26.363+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:02:26.365+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:02:26.366+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:02:26.373+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:02:26.375+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:02:26.376+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:06:20.705+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:06:20.708+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:06:20.711+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:06:20.719+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:06:20.906+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:06:20.906+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:06:20.906+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:06:20.929+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:06:20.929+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:06:20.930+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:06:21.130+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:06:21.149+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:06:21.332+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:06:24.655+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:06:24.716+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:06:24.717+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:06:24.734+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [20s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:06:25.368+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:06:25.380+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:07:42.448+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:07:42.450+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:07:42.454+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:07:42.461+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:07:42.657+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:07:42.658+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:07:42.658+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:07:42.681+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:07:42.682+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:07:42.683+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:07:42.891+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:07:42.913+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:07:43.109+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:07:46.549+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:07:46.578+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:07:46.579+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:07:46.589+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [20s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:07:47.163+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:07:47.163+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:08:27.222+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:08:27.224+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:08:27.228+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:08:27.237+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:08:27.436+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:08:27.436+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:08:27.436+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:08:27.466+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:08:27.466+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:08:27.467+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:08:27.676+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:08:27.698+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:08:27.876+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:08:32.316+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:08:32.341+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:08:32.341+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:08:32.351+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [30s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:08:32.920+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:08:32.920+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:08:38.084+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:08:38.085+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674684518063
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:08:38.111+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:08:38.111+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:08:38.111+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:08:39.085+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:08:39.087+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674684519078
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:08:39.103+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:08:39.105+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:08:39.106+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:08:40.089+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:08:40.091+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674684520083
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:08:40.094+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:08:40.094+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:08:40.095+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:08:40.097+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:08:40.097+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:08:40.097+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:08:41.094+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:08:41.096+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674684521087
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:08:41.099+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:08:41.100+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-25T23:08:41.101+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:09:25.728+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:09:25.730+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:09:25.733+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:09:25.742+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:09:25.923+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:09:25.923+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:09:25.923+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:09:25.947+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:09:25.948+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:09:25.949+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:09:26.178+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:09:26.198+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:09:26.377+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:09:34.097+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:09:34.115+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:09:34.116+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:09:34.130+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this before [30s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:09:34.771+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:09:34.771+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:09:37.936+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:09:37.937+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674684577914
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:09:37.961+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:09:37.962+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:09:37.962+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:09:38.937+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:09:38.939+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674684578930
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:09:38.955+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:09:38.956+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:09:38.958+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:09:39.942+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:09:39.944+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674684579935
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:09:39.953+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:09:39.955+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:09:39.956+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:09:39.965+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:09:39.966+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:09:39.967+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:09:40.948+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:09:40.949+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674684580940
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:09:40.953+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:09:40.955+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-25T23:09:40.956+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:13:19.046+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:13:19.048+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:13:19.051+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:13:19.060+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:13:19.252+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:13:19.252+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:13:19.252+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:13:19.274+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:13:19.275+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:13:19.276+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:13:19.488+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:13:19.508+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:13:19.684+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:13:24.052+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:13:24.082+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:13:24.082+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:13:24.094+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
//	not(ConcernICTGatewayEvent(
//		this.senderID == $aEvent.getSenderID(),
//		this.destinationID == $aEvent.getDestinationID(),
//		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageCategory == "DATA",
//		this after [30s] $aEvent));
	
then
	KieLauncher.printInfo($aEvent.getTimestamp());
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:15:38.919+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:15:38.921+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:15:38.924+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:15:38.932+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:15:39.119+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:15:39.119+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:15:39.119+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:15:39.143+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:15:39.144+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:15:39.145+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:15:39.338+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:15:39.357+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:15:39.533+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:15:42.275+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:15:42.293+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:15:42.294+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:15:42.304+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
//	not(ConcernICTGatewayEvent(
//		this.senderID == $aEvent.getSenderID(),
//		this.destinationID == $aEvent.getDestinationID(),
//		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageCategory == "DATA",
//		this after [30s] $aEvent));
	
then
	KieLauncher.printInfo($aEvent.getTimestamp().ToString());
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:16:16.173+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:16:16.175+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:16:16.179+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:16:16.187+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:16:16.439+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:16:16.440+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:16:16.440+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:16:16.470+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:16:16.470+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:16:16.472+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:16:16.683+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:16:16.704+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:16:16.892+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:16:19.704+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:16:19.773+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:16:19.775+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:16:19.795+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
//	not(ConcernICTGatewayEvent(
//		this.senderID == $aEvent.getSenderID(),
//		this.destinationID == $aEvent.getDestinationID(),
//		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageCategory == "DATA",
//		this after [30s] $aEvent));
	
then
	KieLauncher.printInfo($aEvent.timestamp);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:16:58.465+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:16:58.468+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:16:58.472+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:16:58.482+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:16:58.688+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:16:58.688+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:16:58.689+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:16:58.715+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:16:58.716+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:16:58.717+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:16:58.932+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:16:58.953+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:16:59.135+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:17:02.802+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:17:02.851+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:17:02.851+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:17:02.866+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
//	not(ConcernICTGatewayEvent(
//		this.senderID == $aEvent.getSenderID(),
//		this.destinationID == $aEvent.getDestinationID(),
//		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageCategory == "DATA",
//		this after [30s] $aEvent));
	
then
	KieLauncher.printInfo((String)$aEvent.getTimestamp());
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:17:17.753+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:17:17.770+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:17:17.770+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:17:17.771+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		

	
then
	KieLauncher.printInfo((String)$aEvent.getTimestamp());
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:19:15.364+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:19:15.365+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:19:15.368+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:19:15.378+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:19:15.568+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:19:15.568+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:19:15.568+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:19:15.590+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:19:15.591+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:19:15.592+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:19:15.790+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:19:15.809+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:19:15.982+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:19:21.397+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:19:21.420+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:19:21.421+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:19:21.431+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		

	
then
	KieLauncher.printInfo($aEvent.getSenderID());
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:19:22.036+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:19:22.036+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:20:36.514+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:20:36.516+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:20:36.519+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:20:36.528+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:20:36.789+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:20:36.790+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:20:36.790+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:20:36.820+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:20:36.820+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:20:36.821+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:20:37.012+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:20:37.030+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:20:37.203+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:20:39.899+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:20:39.925+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:20:39.926+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:20:39.937+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
//	not(ConcernICTGatewayEvent(
//		this.senderID == $aEvent.getSenderID(),
//		this.destinationID == $aEvent.getDestinationID(),
//		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageCategory == "DATA",
//		this after [30s] $aEvent));
	
then
	KieLauncher.printInfo($aEvent.getTimestamp().toString());
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:23:37.572+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:23:37.575+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:23:37.579+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:23:37.590+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:23:37.800+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:23:37.801+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:23:37.801+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:23:37.824+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:23:37.825+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:23:37.826+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:23:38.029+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:23:38.048+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:23:38.223+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:23:40.892+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:23:40.916+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:23:40.917+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:23:40.929+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : double
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : double
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
//	not(ConcernICTGatewayEvent(
//		this.senderID == $aEvent.getSenderID(),
//		this.destinationID == $aEvent.getDestinationID(),
//		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageCategory == "DATA",
//		this after [30s] $aEvent));
	
then
	KieLauncher.printEvent($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:23:41.622+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:23:41.622+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:23:47.755+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:23:47.756+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674685427737
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:23:47.790+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:47.790+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:23:47.791+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:48.758+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:23:48.760+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674685428750
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:23:48.775+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:48.777+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:23:48.779+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:49.763+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:23:49.765+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674685429756
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:23:49.775+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:49.777+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:23:49.779+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:49.787+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:49.788+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - FirstAndSecondAndThirdEvent( destinationID=Monitoring, senderID=ICTGW_Probe, first=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@6e33e8ea, second=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@5171fe35, third=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@655471b9, name=AUTHENTICATION_REQUEST-REGISTRATION_RESPONSE-TOPOLOGY_ELEMENTS_RESPONSE, timestamp=1.674685427737E12 )
2023-01-25T23:23:49.790+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:49.791+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:23:49.791+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:23:49.792+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:23:50.768+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:23:50.769+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674685430761
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:23:50.772+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:23:50.772+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-25T23:23:50.772+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:11.554+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:25:11.556+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:25:11.559+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:25:11.567+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:25:11.814+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:25:11.814+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:25:11.814+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:25:11.843+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:25:11.843+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:25:11.844+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:25:12.036+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:25:12.054+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:25:12.230+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:25:15.425+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:25:15.454+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:25:15.455+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:25:15.466+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
//	not(ConcernICTGatewayEvent(
//		this.senderID == $aEvent.getSenderID(),
//		this.destinationID == $aEvent.getDestinationID(),
//		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
//		this.ICTMessageCategory == "DATA",
//		this after [30s] $aEvent));
	
then
	KieLauncher.printEvent($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:25:16.066+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:25:16.066+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:25:29.974+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:25:29.974+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674685529953
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:25:30.010+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:30.010+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:25:30.010+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:30.977+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:25:30.979+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674685530970
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:25:30.994+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:30.996+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:25:30.997+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:31.982+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:25:31.984+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674685531975
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:25:31.996+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:31.998+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:25:32.000+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:32.006+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:32.008+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - FirstAndSecondAndThirdEvent( destinationID=Monitoring, senderID=ICTGW_Probe, first=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@7b15e7ec, second=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@4eff2f, third=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@6ef75b2e, name=AUTHENTICATION_REQUEST-REGISTRATION_RESPONSE-TOPOLOGY_ELEMENTS_RESPONSE, timestamp=1674685529953 )
2023-01-25T23:25:32.009+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:32.010+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:25:32.011+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:25:32.012+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:25:32.987+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:25:32.988+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674685532981
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:25:32.991+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:25:32.991+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-25T23:25:32.991+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:14.047+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:26:14.050+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:26:14.054+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:26:14.065+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:26:14.254+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:26:14.254+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:26:14.255+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:26:14.277+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:26:14.277+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:26:14.278+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:26:14.473+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:26:14.493+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:26:14.668+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:26:38.167+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:26:38.190+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:26:38.191+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:26:38.202+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [30s] $aEvent));
	
then
	KieLauncher.printEvent($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:26:38.830+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:26:38.830+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:26:43.077+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:26:43.078+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674685603059
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:26:43.108+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:43.109+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:26:43.109+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:44.080+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:26:44.081+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674685604073
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:26:44.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:44.095+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:26:44.096+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:45.084+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:26:45.085+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674685605078
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:26:45.088+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:45.088+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:26:45.089+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:45.091+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:45.092+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - FirstAndSecondAndThirdEvent( destinationID=Monitoring, senderID=ICTGW_Probe, first=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@6bb95b89, second=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@71e0110a, third=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@72515a25, name=AUTHENTICATION_REQUEST-REGISTRATION_RESPONSE-TOPOLOGY_ELEMENTS_RESPONSE, timestamp=1674685603059 )
2023-01-25T23:26:45.092+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:45.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:26:45.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:26:45.094+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:26:46.089+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:26:46.090+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674685606082
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:26:46.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:46.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-25T23:26:46.094+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:26:56.285+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:26:56.287+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:26:56.290+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:26:56.299+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:26:56.483+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:26:56.483+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:26:56.484+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:26:56.507+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:26:56.507+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:26:56.509+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:26:56.703+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:26:56.722+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:26:56.898+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:27:00.366+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:27:00.391+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:27:00.391+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:27:00.402+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [30s] $aEvent));
	
then
	KieLauncher.printEvent($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:27:01.104+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:27:01.104+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:27:37.815+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:27:37.816+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674685657796
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:27:37.847+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:27:37.847+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:27:37.848+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:27:38.818+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:27:38.820+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674685658811
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:27:38.824+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:27:38.825+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:27:38.825+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:27:39.823+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:27:39.825+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674685659816
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:27:39.834+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:27:39.836+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:27:39.837+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:27:39.844+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:27:39.845+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - FirstAndSecondAndThirdEvent( destinationID=Monitoring, senderID=ICTGW_Probe, first=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@79163981, second=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@478ec065, third=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@38e46c3e, name=AUTHENTICATION_REQUEST-REGISTRATION_RESPONSE-TOPOLOGY_ELEMENTS_RESPONSE, timestamp=1674685657796 )
2023-01-25T23:27:39.846+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:27:39.847+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:27:39.848+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:27:39.848+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:30:09.670+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:30:09.672+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:30:09.675+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:30:09.684+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:30:09.923+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:30:09.923+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:30:09.924+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:30:09.951+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:30:09.951+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:30:09.952+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:30:10.149+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:30:10.172+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:30:10.385+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:30:14.319+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:30:14.376+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:30:14.377+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:30:14.395+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,30s] $aEvent));
	
then
	KieLauncher.printEvent($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:30:14.994+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:30:14.994+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:30:18.401+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:30:18.401+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674685818379
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:30:18.428+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:30:18.428+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:30:18.428+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:30:19.404+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:30:19.415+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:30:19.416+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674685819397
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:30:19.416+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:30:19.418+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:30:20.410+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:30:20.412+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674685820402
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:30:20.422+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:30:20.423+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:30:20.425+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:30:20.432+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:30:20.434+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - FirstAndSecondAndThirdEvent( destinationID=Monitoring, senderID=ICTGW_Probe, first=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@6eabedd8, second=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@14fab029, third=it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent@4e83bb5c, name=AUTHENTICATION_REQUEST-REGISTRATION_RESPONSE-TOPOLOGY_ELEMENTS_RESPONSE, timestamp=1674685818379 )
2023-01-25T23:30:20.435+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:30:20.436+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:30:20.437+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:30:20.439+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:31:21.939+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:31:21.941+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:31:21.944+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:31:21.955+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:31:22.146+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:31:22.146+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:31:22.146+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:31:22.170+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:31:22.171+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:31:22.172+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:31:22.384+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:31:22.402+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:31:22.580+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:31:25.814+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:31:25.856+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:31:25.856+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:31:25.868+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not($bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,30s] $aEvent));
	
then
	KieLauncher.printEvent($aEvent);
	KieLauncher.printEvent($bEvent);
	
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:32:32.545+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:32:32.547+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:32:32.550+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:32:32.558+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:32:32.800+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:32:32.801+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:32:32.801+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:32:32.828+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:32:32.829+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:32:32.830+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:32:33.029+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:32:33.049+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:32:33.225+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:32:38.643+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:32:38.661+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:32:38.661+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:32:38.672+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	$bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,30s] $aEvent));
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:32:57.678+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:32:57.680+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:32:57.683+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:32:57.691+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:32:57.873+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:32:57.874+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:32:57.874+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:32:57.898+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:32:57.899+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:32:57.900+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:32:58.103+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:32:58.123+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:32:58.299+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:33:02.694+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:33:02.751+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:33:02.751+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:33:02.766+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	$bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,30s] $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

2023-01-25T23:33:03.382+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:33:03.382+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:33:07.745+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:33:07.745+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674685987722
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:33:07.777+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:33:07.778+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:33:07.778+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:33:08.747+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:33:08.749+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674685988740
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:33:08.759+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:33:08.760+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:33:08.762+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:33:09.750+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:33:09.752+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674685989744
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:33:09.761+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:33:09.763+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:33:09.764+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:34:19.756+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:34:19.757+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674686059711
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:34:19.760+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:34:19.760+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-25T23:34:19.761+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:37:14.078+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:37:14.080+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:37:14.083+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:37:14.091+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:37:14.273+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:37:14.274+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:37:14.274+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:37:14.298+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:37:14.298+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:37:14.300+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:37:14.499+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:37:14.519+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:37:14.694+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:37:18.799+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:37:18.826+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:37:18.827+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:37:18.838+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	$bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,30s] $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end

rule "catchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end
2023-01-25T23:37:19.448+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:37:19.448+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 10
2023-01-25T23:37:35.964+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:37:35.964+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674686255943
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:37:35.991+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:37:35.991+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:37:35.991+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:37:36.966+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:37:36.969+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674686256960
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:37:36.980+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:37:36.982+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:37:36.984+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:37:37.971+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:37:37.973+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674686257965
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:37:37.983+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:37:37.984+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:37:37.986+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:38:07.971+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:38:07.971+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674686287969
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:38:07.974+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:38:07.974+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-25T23:38:07.974+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:43:29.621+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:43:29.624+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:43:29.628+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:43:29.639+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:43:29.830+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:43:29.830+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:43:29.831+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:43:29.854+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:43:29.855+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:43:29.856+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:43:30.054+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:43:30.073+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:43:30.251+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:43:33.540+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:43:33.562+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:43:33.563+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:43:33.574+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	$bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,5s] $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:43:34.150+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:43:34.157+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T23:43:38.012+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:43:38.013+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674686617994
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:43:38.044+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:43:38.045+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:43:38.045+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:43:39.015+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:43:39.016+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674686619008
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:43:39.028+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:43:39.030+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:43:39.032+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:43:40.020+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:43:40.022+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674686620013
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:43:40.031+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:43:40.033+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:43:40.034+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:43:46.026+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:43:46.028+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674686626018
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:44:16.818+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:44:16.820+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:44:16.824+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:44:16.832+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:44:17.034+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:44:17.034+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:44:17.035+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:44:17.065+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:44:17.066+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:44:17.067+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:44:17.264+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:44:17.282+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:44:17.457+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:44:28.417+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:44:28.452+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:44:28.453+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:44:28.465+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	$bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this before [0,5s] $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:44:29.037+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:44:29.038+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T23:44:33.367+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:44:33.368+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674686673344
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:44:33.396+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:44:33.396+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:44:33.396+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:44:34.371+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:44:34.373+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674686674362
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:44:34.383+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:44:34.385+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:44:34.386+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:44:35.374+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:44:35.375+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674686675368
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:44:35.384+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:44:35.384+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:44:35.385+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:44:41.378+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:44:41.379+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674686681372
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:49:50.588+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:49:50.590+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:49:50.594+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:49:50.602+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:49:50.796+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:49:50.796+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:49:50.797+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:49:50.819+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:49:50.819+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:49:50.821+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:49:51.027+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:49:51.047+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:49:51.232+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:49:55.627+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:49:55.647+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:49:55.647+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:49:55.661+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	$bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA") over window:time(10s);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:49:56.256+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:49:56.256+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T23:49:58.953+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:49:58.954+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674686998935
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:49:58.982+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:49:58.982+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:49:58.982+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:49:59.957+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:49:59.960+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674686999949
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:49:59.971+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:49:59.973+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:49:59.974+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:50:00.963+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:50:00.965+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674687000955
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:50:00.975+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:50:00.976+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:50:00.978+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:50:06.968+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:50:06.970+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674687006960
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:50:06.991+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:50:06.993+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:50:06.994+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:50:47.688+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:50:47.690+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:50:47.694+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:50:47.703+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:50:47.887+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:50:47.887+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:50:47.888+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:50:47.910+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:50:47.910+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:50:47.912+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:50:48.107+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:50:48.129+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:50:48.316+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:50:54.179+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:50:54.207+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:50:54.207+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:50:54.218+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	$bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA") over window:time(10s);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:50:54.848+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:50:54.848+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T23:50:59.312+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:50:59.313+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674687059291
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:50:59.338+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:50:59.338+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:50:59.338+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:51:00.314+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:51:00.316+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674687060306
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:51:00.330+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:51:00.332+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:51:00.333+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:51:01.318+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:51:01.319+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674687061312
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:51:01.326+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:51:01.326+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:51:01.327+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:51:11.321+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:51:11.322+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674687071316
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:51:11.329+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:51:11.329+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:51:11.330+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:51:52.974+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:51:52.976+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:51:52.979+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:51:52.987+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:51:53.161+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:51:53.162+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:51:53.162+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:51:53.183+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:51:53.184+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:51:53.185+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:51:53.382+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:51:53.402+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:51:53.577+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:52:02.393+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:52:02.417+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:52:02.418+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:52:02.428+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	$bEvent : ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA") over window:time(10s);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:52:03.040+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:52:03.041+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T23:52:06.922+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:52:06.922+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674687126903
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:52:06.948+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:52:06.949+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:52:06.949+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:52:07.926+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:52:07.929+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674687127918
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:52:07.943+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:52:07.945+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:52:07.947+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:52:08.931+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:52:08.933+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674687128925
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:52:08.943+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:52:08.945+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:52:08.947+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:52:09.936+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:52:09.937+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674687129929
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:52:09.954+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:52:09.955+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:52:09.956+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:55:41.017+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:55:41.019+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:55:41.024+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:55:41.035+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:55:41.277+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:55:41.277+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:55:41.278+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:55:41.303+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:55:41.304+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:55:41.305+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:55:41.502+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:55:41.521+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:55:41.701+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:55:47.508+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:55:47.535+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:55:47.536+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:55:47.548+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA") )over window:time(10s);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:56:11.540+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:56:11.542+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:56:11.546+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:56:11.555+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:56:11.736+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:56:11.737+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:56:11.737+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:56:11.780+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:56:11.781+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:56:11.783+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:56:11.988+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:56:12.007+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:56:12.184+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:56:14.843+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:56:14.866+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:56:14.867+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:56:14.876+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA")over window:time(10s));
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:56:36.550+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:56:36.552+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:56:36.555+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:56:36.563+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:56:36.721+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:56:36.721+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:56:36.721+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:56:36.744+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:56:36.745+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:56:36.746+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:56:36.956+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:56:36.976+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:56:37.150+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:56:39.596+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:56:39.615+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:56:39.616+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:56:39.626+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA")over window:time(10s));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:56:40.230+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:56:40.230+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T23:56:44.724+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:56:44.725+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674687404705
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:56:44.750+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:56:44.751+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:56:44.751+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:56:45.726+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:56:45.726+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674687405720
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:56:45.731+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:56:45.732+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:56:45.732+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:56:46.732+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:56:46.734+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674687406725
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:56:46.744+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:56:46.745+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:56:46.747+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:56:46.754+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:56:46.756+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:56:46.757+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:56:47.738+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:56:47.749+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674687407730
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:56:47.752+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:56:47.754+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-25T23:56:47.755+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:58:34.230+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:58:34.233+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:58:34.237+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:58:34.247+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:58:34.442+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:58:34.442+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:58:34.442+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:58:34.472+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:58:34.472+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:58:34.473+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:58:34.670+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:58:34.692+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:58:34.877+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:58:36.722+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:58:36.744+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:58:36.745+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:58:36.755+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA") this after[10s] $aEvent);
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:58:59.189+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:58:59.191+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:58:59.194+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:58:59.203+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:58:59.403+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:58:59.403+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:58:59.414+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:58:59.460+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:58:59.461+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:58:59.462+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:58:59.660+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:58:59.678+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:58:59.859+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-25T23:59:03.288+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-25T23:59:03.312+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-25T23:59:03.312+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-25T23:59:03.323+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA", this after[10s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-25T23:59:03.978+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-25T23:59:03.979+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-25T23:59:08.713+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:59:08.714+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674687548694
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:59:08.740+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:59:08.740+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-25T23:59:08.741+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:59:09.716+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:59:09.717+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674687549709
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:59:09.731+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:59:09.733+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-25T23:59:09.735+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:59:10.721+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:59:10.722+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674687550714
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:59:10.726+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:59:10.727+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-25T23:59:10.727+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-25T23:59:10.730+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:59:10.730+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-25T23:59:10.730+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:59:11.726+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-25T23:59:11.728+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674687551719
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-25T23:59:11.732+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:59:11.733+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-25T23:59:11.734+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-25T23:59:59.098+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-25T23:59:59.100+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-25T23:59:59.103+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-25T23:59:59.111+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-25T23:59:59.305+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-25T23:59:59.306+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-25T23:59:59.306+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-25T23:59:59.328+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-25T23:59:59.328+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-25T23:59:59.329+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-25T23:59:59.539+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-25T23:59:59.566+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-25T23:59:59.748+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:00:01.727+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:00:01.751+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:00:01.751+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:00:01.762+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "timeFailingForCatchThirdAndFourth"
no-loop
salience 992
dialect "java"
when
	$aEvent : FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA", this before[10s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printWarning("Cycle not completed in the expected timeframe - Rule fired:" + drools.getRule().getName());
end


2023-01-26T00:00:02.334+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:00:02.334+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:00:05.016+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:00:05.016+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674687604995
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:00:05.044+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:00:05.044+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:00:05.045+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:00:06.017+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:00:06.019+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674687606010
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:00:06.031+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:00:06.032+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:00:06.034+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:00:07.022+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:00:07.023+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674687607015
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:00:07.035+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:00:07.036+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:00:07.038+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:00:07.045+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:00:07.046+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle not completed in the expected timeframe - Rule fired:timeFailingForCatchThirdAndFourth
2023-01-26T00:00:07.046+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:00:08.026+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:00:08.027+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674687608020
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:00:08.030+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:00:08.032+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-26T00:00:08.033+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:04:11.416+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:04:11.418+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:04:11.421+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:04:11.429+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:04:11.633+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:04:11.634+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:04:11.634+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:04:11.664+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:04:11.665+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:04:11.667+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:04:11.875+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:04:11.894+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:04:12.075+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:04:15.130+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:04:15.153+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:04:15.153+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:04:15.163+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end




rule "catchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent) over window:time(5s);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:04:15.828+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:04:15.828+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:04:18.072+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:04:18.073+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674687858050
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:04:18.099+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:04:18.099+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:04:18.099+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:04:19.073+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:04:19.076+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674687859066
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:04:19.085+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:04:19.087+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:04:19.088+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:04:20.079+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:04:20.082+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674687860071
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:04:20.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:04:20.095+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:04:20.097+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:04:21.084+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:04:21.086+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674687861077
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:04:21.105+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:04:21.107+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-26T00:04:21.108+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:04:55.544+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:04:55.546+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:04:55.550+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:04:55.558+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:04:55.733+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:04:55.733+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:04:55.733+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:04:55.754+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:04:55.754+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:04:55.755+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:04:55.959+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:04:55.978+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:04:56.155+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:05:02.801+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:05:02.850+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:05:02.851+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:05:02.867+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end




rule "catchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent) over window:time(1s);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:05:03.519+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:05:03.530+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:05:06.942+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:05:06.943+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674687906920
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:05:06.975+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:05:06.976+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:05:06.976+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:05:07.943+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:05:07.946+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674687907936
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:05:07.955+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:05:07.956+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:05:07.958+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:05:08.949+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:05:08.959+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:05:08.960+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674687908941
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:05:08.961+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:05:08.962+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:05:12.954+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:05:12.956+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674687912946
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:05:12.975+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:05:12.977+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-26T00:05:12.978+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:08:42.613+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:08:42.615+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:08:42.618+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:08:42.626+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:08:42.823+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:08:42.823+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:08:42.823+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:08:42.847+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:08:42.847+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:08:42.848+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:08:43.044+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:08:43.062+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:08:43.238+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:08:47.130+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:08:47.199+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:08:47.200+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:08:47.215+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
duration 10s
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0s,10s] $aEvent));
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:09:11.038+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:09:11.040+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:09:11.043+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:09:11.052+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:09:11.235+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:09:11.236+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:09:11.236+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:09:11.263+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:09:11.263+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:09:11.265+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:09:11.464+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:09:11.484+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:09:11.662+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:09:14.126+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:09:14.155+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:09:14.155+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:09:14.168+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
duration ( 10s )
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0s,10s] $aEvent));
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:09:44.188+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:09:44.190+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:09:44.193+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:09:44.202+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:09:44.374+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:09:44.374+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:09:44.375+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:09:44.410+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:09:44.411+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:09:44.412+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:09:44.621+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:09:44.640+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:09:44.813+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:09:47.275+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:09:47.315+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:09:47.316+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:09:47.330+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
duration ( 10s )
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,10s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:09:47.949+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:09:47.949+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:10:22.250+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:10:22.250+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674688222231
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:10:22.277+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:10:22.278+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:10:22.278+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:10:23.253+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:10:23.255+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674688223245
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:10:23.270+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:10:23.272+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:10:23.274+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:10:24.258+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:10:24.260+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674688224251
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:10:24.269+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:10:24.271+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:10:24.272+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:10:28.263+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:10:28.265+0100 [ActiveMQ Session Task-2] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674688228256
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:11:29.104+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:11:29.106+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:11:29.110+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:11:29.119+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:11:29.308+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:11:29.308+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:11:29.309+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:11:29.331+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:11:29.331+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:11:29.332+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:11:29.537+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:11:29.557+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:11:29.735+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:11:31.868+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:11:31.891+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:11:31.891+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:11:31.902+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
duration ( 10s )
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,10s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:11:32.497+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:11:32.498+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:11:35.344+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:11:35.345+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674688295324
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:11:35.371+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:11:35.371+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:11:35.371+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:11:36.342+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:11:36.344+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674688296338
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:11:36.351+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:11:36.352+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:11:36.352+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:11:37.348+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:11:37.350+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674688297341
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:11:37.359+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:11:37.360+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:11:37.361+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:11:38.353+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:11:38.353+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674688298346
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:12:22.432+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:12:22.434+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:12:22.437+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:12:22.445+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:12:22.644+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:12:22.645+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:12:22.645+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:12:22.672+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:12:22.672+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:12:22.673+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:12:22.866+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:12:22.886+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:12:23.090+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:12:25.187+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:12:25.236+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:12:25.237+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:12:25.251+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
duration ( 10s )
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after [0,10s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:12:25.855+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:12:25.855+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:12:28.682+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:12:28.682+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674688348661
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:12:28.714+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:12:28.715+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:12:28.715+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:12:29.684+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:12:29.686+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674688349678
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:12:29.695+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:12:29.697+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:12:29.698+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:12:30.685+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:12:30.686+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674688350682
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:12:30.691+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:12:30.692+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:12:30.692+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:12:40.696+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:12:40.697+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-26T00:12:40.697+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:12:42.692+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:12:42.694+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674688362685
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:12:42.698+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:12:42.700+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-26T00:12:42.702+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:13:22.481+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:13:22.483+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:13:22.486+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:13:22.494+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:13:22.692+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:13:22.692+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:13:22.692+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:13:22.714+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:13:22.714+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:13:22.716+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:13:22.911+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:13:22.931+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:13:23.103+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:13:24.889+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:13:24.936+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:13:24.937+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:13:24.951+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
duration ( 10s )
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this before [0,10s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:13:25.604+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:13:25.604+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:13:27.725+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:13:27.725+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674688407706
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:13:27.760+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:13:27.761+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:13:27.761+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:13:28.728+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:13:28.730+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674688408721
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:13:28.741+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:13:28.742+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:13:28.744+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:13:29.733+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:13:29.735+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674688409726
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:13:29.747+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:13:29.748+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:13:29.750+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:13:31.738+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:13:31.740+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674688411731
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:13:39.761+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:13:39.763+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-26T00:13:39.764+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:13:39.767+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:13:39.769+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-26T00:13:39.770+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:14:08.563+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:14:08.565+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:14:08.569+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:14:08.577+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:14:08.760+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:14:08.760+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:14:08.760+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:14:08.784+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:14:08.784+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:14:08.786+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:14:08.997+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:14:09.014+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:14:09.188+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:14:12.714+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:14:12.746+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:14:12.746+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:14:12.760+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	not(ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this before [0,10s] $aEvent));
	
then
	retract($aEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:14:13.355+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:14:13.356+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:14:15.569+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:14:15.570+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674688455547
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:14:15.599+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:14:15.600+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:14:15.600+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:14:16.570+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:14:16.573+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674688456562
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:14:16.582+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:14:16.583+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:14:16.584+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:14:17.574+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:14:17.575+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674688457568
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:14:17.584+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:14:17.586+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:14:17.587+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:14:17.594+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:14:17.595+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-26T00:14:17.596+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:14:18.575+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:14:18.576+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674688458572
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:14:18.577+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:14:18.577+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-26T00:14:18.578+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:16:44.213+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:16:44.216+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:16:44.219+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:16:44.228+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:16:44.469+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:16:44.470+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:16:44.470+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:16:44.499+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:16:44.499+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:16:44.501+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:16:44.708+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:16:44.728+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:16:44.902+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:16:47.822+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:16:47.883+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:16:47.884+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:16:47.902+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:16:48.490+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:16:48.490+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:16:50.080+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:16:50.080+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: AUTHENTICATION_REQUEST
Destination: Monitoring
Data: ICTMessagePayload0
SenderID: ICTGW_Probe
Timestamp: 1674688610061
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:16:50.106+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:16:50.107+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Session started - Rule fired:checkFirst
2023-01-26T00:16:50.107+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:16:51.083+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:16:51.084+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: REGISTRATION_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload1
SenderID: ICTGW_Probe
Timestamp: 1674688611076
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:16:51.097+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:16:51.099+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first and second created - Rule fired:catchFirstAndSecond
2023-01-26T00:16:51.100+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:16:52.088+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:16:52.089+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENTS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload2
SenderID: ICTGW_Probe
Timestamp: 1674688612081
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:16:52.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:16:52.093+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - ComplexEvent first, second and third created - Rule fired:catchSecondAndThird
2023-01-26T00:16:52.094+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:16:53.093+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:16:53.095+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674688613086
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:16:53.102+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:16:53.103+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Cycle completed - Rule fired:catchThirdAndFourth
2023-01-26T00:16:53.104+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
2023-01-26T00:22:06.697+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-01-26T00:22:06.700+0100 [main] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-01-26T00:22:06.704+0100 [main] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-01-26T00:22:06.714+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Creating TrasportConnector
2023-01-26T00:22:06.958+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Waiting for broker start
2023-01-26T00:22:06.959+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - broker started
2023-01-26T00:22:06.959+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Enabling SSL ConnectionFactory
2023-01-26T00:22:06.984+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Connection sucessfully created
2023-01-26T00:22:06.984+0100 [main] DEBUG it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Component ActiveMQBrokerManager loaded in registry.
2023-01-26T00:22:06.986+0100 [main] INFO  it.cnr.isti.labsedc.concern.storage.MySQLStorageController - Setting up storage with default parameters
2023-01-26T00:22:07.190+0100 [main] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-01-26T00:22:07.210+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-01-26T00:22:07.401+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-01-26T00:22:11.058+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - sending rule
2023-01-26T00:22:11.097+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - rule sent
2023-01-26T00:22:11.097+0100 [main] INFO  it.cnr.isti.labsedc.concern.consumer.Consumer - Rule to be monitored Sent
2023-01-26T00:22:11.110+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Jan 24, 2023 - 17:41:32
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;

//Check a sequence of events strictly

dialect "java"

declare ConcernICTGatewayEvent
    @role( event )
    @timestamp( timestamp )
    @expires(2m)
end


declare FirstAndSecondEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
    destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second : ConcernICTGatewayEvent
	name : String
	timestamp : long
end

declare FirstAndSecondAndThirdEvent
    @role( event )
    @expires(2m)
    @timestamp ( timestamp )
	destinationID : String
	senderID : String	
	first : ConcernICTGatewayEvent
	second: ConcernICTGatewayEvent
	third : ConcernICTGatewayEvent
	name: String
	timestamp : long
end

rule "checkFirst"
no-loop
salience 1000
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false);

then
		$aEvent.setConsumed(true);
		update($aEvent);
		KieLauncher.printInfo("Session started - Rule fired:" + drools.getRule().getName());	
end

rule "checkStarter"
no-loop
salience 999
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.consumed == false);
	not(ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true, 
		this before $aEvent) || FirstAndSecondEvent() || FirstAndSecondAndThirdEvent()
		);
then
		retract($aEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end



rule "doubleStart"
no-loop
salience 998
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == false,
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchFirstAndCheckSecond"
no-loop
salience 997
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.consumed == true);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "REGISTRATION_RESPONSE" || this.ICTMessageType != "REGISTRATION_RESPONSE" ||  this.ICTMessageCategory != "REGISTRATION",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end


rule "catchFirstAndSecond"
no-loop
salience 996
dialect "java"
when
	$aEvent: ConcernICTGatewayEvent(
		this.senderID == "ICTGW_Probe",
		this.destinationID == "Monitoring",
		this.name == "AUTHENTICATION_REQUEST",
		this.ICTMessageType == "AUTHENTICATION_REQUEST",
		this.ICTMessageCategory == "AUTHENTICATION",
		this.consumed == true
		);
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID,
		this.destinationID == $aEvent.getDestinationID,
		this.name == "REGISTRATION_RESPONSE",
		this.ICTMessageType == "REGISTRATION_RESPONSE",
		this.ICTMessageCategory == "REGISTRATION",
		this after $aEvent);
	
then
	FirstAndSecondEvent captured = new FirstAndSecondEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent);
	captured.setSecond($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first and second created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectThird"
no-loop
salience 995
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENTS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENTS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());
end

rule "catchSecondAndThird"
no-loop
salience 994
dialect "java"
when
	$aEvent: FirstAndSecondEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENTS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);	
then
	FirstAndSecondAndThirdEvent captured = new FirstAndSecondAndThirdEvent();
	captured.setTimestamp($aEvent.getTimestamp());
	captured.setFirst($aEvent.getFirst());
	captured.setSecond($aEvent.getSecond());
	captured.setThird($bEvent);
	captured.setDestinationID($aEvent.getDestinationID());
	captured.setSenderID($aEvent.getSenderID());
	captured.setName($aEvent.getName() + "-" + $bEvent.getName());
	insert(captured);
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("ComplexEvent first, second and third created - Rule fired:" + drools.getRule().getName());
end

rule "checkForCorrectFourth"
no-loop
salience 993
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" || this.ICTMessageType != "TOPOLOGY_ELEMENT_DETAILS_RESPONSE" ||  this.ICTMessageCategory != "DATA",
		this after $aEvent);
then
		retract($aEvent);
		retract($bEvent);
		KieLauncher.printWarning("Unattended event - Rule fired:" + drools.getRule().getName());	
end


rule "catchThirdAndFourth"
no-loop
salience 991
dialect "java"
when
	$aEvent: FirstAndSecondAndThirdEvent();
		
	$bEvent: ConcernICTGatewayEvent(
		this.senderID == $aEvent.getSenderID(),
		this.destinationID == $aEvent.getDestinationID(),
		this.name == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageType == "TOPOLOGY_ELEMENT_DETAILS_RESPONSE",
		this.ICTMessageCategory == "DATA",
		this after $aEvent);
	
then
	retract($aEvent);
	retract($bEvent);
	KieLauncher.printInfo("Cycle completed - Rule fired:" + drools.getRule().getName());
end

2023-01-26T00:22:11.695+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-01-26T00:22:11.695+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 9
2023-01-26T00:22:15.045+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne received an event of type:
it.cnr.isti.labsedc.concern.event.ConcernICTGatewayEvent in the stream, sent from ICTGW_Probe
2023-01-26T00:22:15.047+0100 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - with data:
Name: TOPOLOGY_ELEMENT_DETAILS_RESPONSE
Destination: Monitoring
Data: ICTMessagePayload3
SenderID: ICTGW_Probe
Timestamp: 1674688934999
SessionID: sessionID
Checksum: noChecksum
CepType: DROOLS
2023-01-26T00:22:15.079+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
2023-01-26T00:22:15.079+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - Unattended event - Rule fired:checkStarter
2023-01-26T00:22:15.079+0100 [Thread-4] INFO  it.cnr.isti.labsedc.concern.utils.KieLauncher - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
