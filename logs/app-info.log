2023-06-12T16:39:48.874+0200 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - 

-----------------------------------------------------
- NEW MONITORING SESSION - ALL COMPONENTS RESTARTED -
-----------------------------------------------------



2023-06-12T16:39:48.877+0200 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Starting components
2023-06-12T16:39:48.881+0200 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.broker.ActiveMQBrokerManager - Start SSL Broker
2023-06-12T16:39:49.101+0200 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Connecting to ActiveMQ
2023-06-12T16:39:49.102+0200 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.ConcernApp - Connected to ActiveMQ
2023-06-12T16:39:49.676+0200 [grizzly-http-server-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - CEP creation 
2023-06-12T16:39:49.706+0200 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne creates a listening channel called: DROOLS-InstanceOne
2023-06-12T16:39:49.996+0200 [Thread-24] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne created Session and fires rules /home/acalabro/eclipse-workspace/ConcernMonitoringRest/src/main/resources/startupRule.drl with knowledgePackages: [[Package name=it.cnr.isti.labsedc.concern.event]]
2023-06-12T16:40:01.099+0200 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne receives rules //created Mar 01, 2023 - 22:57:21
package it.cnr.isti.labsedc.concern.event;
import it.cnr.isti.labsedc.concern.event.ConcernAbstractEvent;
import it.cnr.isti.labsedc.concern.event.ConcernProbeEvent;
import it.cnr.isti.labsedc.concern.event.ConcernBaseEvent;
import it.cnr.isti.labsedc.concern.utils.KieLauncher;
import it.cnr.isti.labsedc.concern.utils.Calculator;
import it.cnr.isti.labsedc.concern.notification.NotificationManager;

//Monitor the quotation received from brokers

dialect "java"

declare ConcernBaseEvent
    @role( event )
    @timestamp( timestamp )
    @expires(60s)
end

rule "At least one quotation per hour"
no-loop
salience 10
dialect "java"
when 

	not(
		$evt : ConcernBaseEvent(
					name == "QuotationFromBroker", 
					senderID == "SevenBullsSimProbe" ) 
				over window:time(10s))
	
    then
	NotificationManager.NotifyViolation(
	"SevenBullsSimProbe", "Warning - actually system does not received any quotation in the last 60 minutes - Rule fired:" + drools.getRule().getName(),
	drools.getRule().getName(), 
	drools.getRule().getMetaData()
	);
end

rule "More than 100 quotation per hour"
no-loop
salience 10
dialect "java"
when 

Number( longValue > 100 ) from accumulate(
	        $evt : ConcernBaseEvent(name == "QuotationFromBroker", senderID == "SevenBullsSimProbe" ) over window:time( 60m ),
	        count(1));
    then
	NotificationManager.NotifyViolation(
	"SevenBullsSimProbe", "Warning - system received more than 100 quotation per hour - Rule fired:" + drools.getRule().getName(),
	drools.getRule().getName(), 
	drools.getRule().getMetaData()
	);
end
2023-06-12T16:40:01.662+0200 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - ...CEP named InstanceOne load rules received into the knowledgeBase
2023-06-12T16:40:01.663+0200 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: java.lang 0
2023-06-12T16:40:01.663+0200 [ActiveMQ Session Task-1] INFO  it.cnr.isti.labsedc.concern.cep.DroolsComplexEventProcessorManager - How many rules within package: it.cnr.isti.labsedc.concern.event 2
